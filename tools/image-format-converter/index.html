<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Format Converter</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <header class="header">
            <span class="eyebrow">画像フォーマット変換</span>
            <h1>Image Format Converter</h1>
            <p>WEBP / PNG / JPG の相互変換。品質・リサイズ・背景色などをオプションで調整して書き出せます。</p>
        </header>

        <div class="card">
            <div class="mode-toggle" role="group" aria-label="処理モード">
                <button type="button" class="mode-btn is-active" data-mode="single" id="singleModeBtn">単一ファイル</button>
                <button type="button" class="mode-btn" data-mode="batch" id="batchModeBtn">バッチ（フォルダ）</button>
                <span class="mode-hint" id="modeHint">プレビュー付きで1枚ずつ確認</span>
            </div>
            <div class="drop-row">
                <div class="drop-zone" id="dropZone">
                    <div class="drop-inner">
                        <p class="primary" id="dropPrimary">ここに画像をドロップ</p>
                        <p class="secondary" id="dropSecondary">またはファイルを選択（WEBP / PNG / JPG）</p>
                        <button class="ghost-button" type="button" id="fileSelect">ファイルを選択</button>
                        <input id="fileInput" type="file" accept="image/webp,image/png,image/jpeg" hidden>
                        <input id="folderInput" type="file" webkitdirectory multiple hidden>
                        <p class="hint" id="dropHint">ローカルファイルのみ対応。複数指定は先頭1枚を使用します。</p>
                    </div>
                </div>
                <div class="file-info" id="fileInfo">
                    <div class="label">ファイル</div>
                    <div class="value" id="fileName">未選択</div>
                    <div class="meta" id="fileMeta">WEBP / PNG / JPG のみ</div>
                    <div class="label">解像度</div>
                    <div class="value" id="fileDims">-</div>
                </div>
                <div class="file-info hidden" id="batchInfo">
                    <div class="label">フォルダ</div>
                    <div class="value" id="folderName">未選択</div>
                    <div class="label">画像枚数</div>
                    <div class="value" id="batchCount">0 枚</div>
                    <div class="label">合計サイズ</div>
                    <div class="value" id="batchSize">-</div>
                    <div class="meta" id="batchMeta">WEBP / PNG / JPG のみを対象。サブフォルダも含めます。</div>
                </div>
            </div>

            <div class="options">
                <div class="option">
                    <div class="option-header">
                        <span class="option-label">出力フォーマット</span>
                    </div>
                    <div class="format-select">
                        <label><input type="radio" name="format" value="image/webp" checked> WEBP</label>
                        <label><input type="radio" name="format" value="image/png"> PNG</label>
                        <label><input type="radio" name="format" value="image/jpeg"> JPG</label>
                    </div>
                </div>

                <div class="option">
                    <div class="option-header">
                        <span class="option-label">品質</span>
                        <span class="option-hint">JPG / WEBP のみ</span>
                    </div>
                    <div class="slider-row">
                        <input type="range" id="quality" min="40" max="100" value="90">
                        <span class="mono" id="qualityValue">90%</span>
                    </div>
                </div>

                <div class="option">
                    <div class="option-header">
                        <span class="option-label">リサイズ</span>
                        <label class="toggle">
                            <input type="checkbox" id="resizeToggle">
                            <span class="toggle-knob"></span>
                        </label>
                    </div>
                    <div class="unit-row" aria-disabled="true" id="resizeUnitRow">
                        <label><input type="radio" name="resizeUnit" value="px" checked disabled> ピクセル指定</label>
                        <label><input type="radio" name="resizeUnit" value="percent" disabled> パーセント指定</label>
                    </div>
                    <div class="resize-grid" aria-disabled="true" id="resizeGrid">
                        <label>幅
                            <input type="number" id="resizeWidth" min="1" inputmode="numeric" disabled>
                        </label>
                        <label>高さ
                            <input type="number" id="resizeHeight" min="1" inputmode="numeric" disabled>
                        </label>
                        <label class="aspect">
                            <input type="checkbox" id="lockRatio" checked disabled>
                            <span>縦横比を維持</span>
                        </label>
                    </div>
                </div>

                <div class="option">
                    <div class="option-header option-header--stack">
                        <span class="option-label">非透過時の背景色</span>
                        <span class="option-hint">透過部分に色を敷きたいときに使います（JPG/PNG/WEBP対応）</span>
                    </div>
                    <div class="color-row color-row--stack">
                        <input type="color" id="bgColor" value="#0b1220">
                        <span class="mono" id="bgColorValue">#0b1220</span>
                        <label class="apply-bg">
                            <input type="checkbox" id="applyBgToggle">
                            <span>非透過PNGにする</span>
                        </label>
                    </div>
                </div>

                <div class="option" id="fileNameOption">
                    <div class="option-header option-header--stack">
                        <span class="option-label">出力ファイル名</span>
                        <span class="option-hint">拡張子は自動付与</span>
                    </div>
                    <input type="text" id="fileBaseName" placeholder="例: converted-image">
                </div>
            </div>

            <div class="controls">
                <div class="status" id="status">準備完了</div>
                <div class="actions">
                    <button class="pill-button" type="button" id="previewButton">プレビュー生成</button>
                    <button class="pill-button" type="button" id="downloadButton">ダウンロード</button>
                    <button class="ghost-button" type="button" id="clearButton">リセット</button>
                </div>
            </div>

            <div id="errorBanner" class="error-banner hidden" role="alert"></div>

            <div class="preview-row" id="previewRow">
                <div class="preview" aria-live="polite">
                    <div class="preview-header">
                        <span class="section-label">入力プレビュー</span>
                        <span class="mono" id="inputInfo">-</span>
                    </div>
                    <div class="preview-frame">
                        <img id="inputImage" alt="入力プレビュー" />
                    </div>
                </div>
                <div class="preview">
                    <div class="preview-header">
                        <span class="section-label">出力プレビュー</span>
                        <span class="mono" id="outputInfo">-</span>
                    </div>
                    <div class="preview-frame">
                        <img id="outputImage" alt="出力プレビュー" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
